"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cognitoConfirmSignup = cognitoConfirmSignup;
const client_cognito_identity_provider_1 = require("@aws-sdk/client-cognito-identity-provider");
const helpers_1 = require("./helpers");
async function cognitoConfirmSignup(user, code, session, config) {
    const cognito = new client_cognito_identity_provider_1.CognitoIdentityProviderClient({
        region: config.awsRegion,
    });
    const validateEmailCommand = new client_cognito_identity_provider_1.ConfirmSignUpCommand({
        ClientId: config.userPoolClientId,
        Username: user,
        ConfirmationCode: code,
        Session: session,
    });
    const { Session } = await cognito.send(validateEmailCommand);
    const initiateAuthCommand = new client_cognito_identity_provider_1.InitiateAuthCommand({
        AuthFlow: client_cognito_identity_provider_1.AuthFlowType.USER_AUTH,
        ClientId: config.userPoolClientId,
        Session,
        AuthParameters: {
            USERNAME: user,
        },
    });
    const initAuthResponse = await cognito.send(initiateAuthCommand);
    return (0, helpers_1.getAuthDataFromAuthInitResponse)(initAuthResponse);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29nbml0by1jb25maXJtLXNpZ24tdXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYWN0aW9ucy9jb2duaXRvLWNvbmZpcm0tc2lnbi11cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQVNBLG9EQThCQztBQXZDRCxnR0FLbUQ7QUFDbkQsdUNBQTREO0FBR3JELEtBQUssVUFBVSxvQkFBb0IsQ0FDeEMsSUFBWSxFQUNaLElBQVksRUFDWixPQUFlLEVBQ2YsTUFBYztJQUVkLE1BQU0sT0FBTyxHQUFHLElBQUksZ0VBQTZCLENBQUM7UUFDaEQsTUFBTSxFQUFFLE1BQU0sQ0FBQyxTQUFTO0tBQ3pCLENBQUMsQ0FBQztJQUVILE1BQU0sb0JBQW9CLEdBQUcsSUFBSSx1REFBb0IsQ0FBQztRQUNwRCxRQUFRLEVBQUUsTUFBTSxDQUFDLGdCQUFnQjtRQUNqQyxRQUFRLEVBQUUsSUFBSTtRQUNkLGdCQUFnQixFQUFFLElBQUk7UUFDdEIsT0FBTyxFQUFFLE9BQU87S0FDakIsQ0FBQyxDQUFDO0lBRUgsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLE1BQU0sT0FBTyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBRTdELE1BQU0sbUJBQW1CLEdBQUcsSUFBSSxzREFBbUIsQ0FBQztRQUNsRCxRQUFRLEVBQUUsK0NBQVksQ0FBQyxTQUFTO1FBQ2hDLFFBQVEsRUFBRSxNQUFNLENBQUMsZ0JBQWdCO1FBQ2pDLE9BQU87UUFDUCxjQUFjLEVBQUU7WUFDZCxRQUFRLEVBQUUsSUFBSTtTQUNmO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztJQUNqRSxPQUFPLElBQUEseUNBQStCLEVBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUMzRCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29nbml0b0lkZW50aXR5UHJvdmlkZXJDbGllbnQsXG4gIENvbmZpcm1TaWduVXBDb21tYW5kLFxuICBJbml0aWF0ZUF1dGhDb21tYW5kLFxuICBBdXRoRmxvd1R5cGUsXG59IGZyb20gXCJAYXdzLXNkay9jbGllbnQtY29nbml0by1pZGVudGl0eS1wcm92aWRlclwiO1xuaW1wb3J0IHsgZ2V0QXV0aERhdGFGcm9tQXV0aEluaXRSZXNwb25zZSB9IGZyb20gXCIuL2hlbHBlcnNcIjtcbmltcG9ydCB7IEF1dGhEYXRhLCBDb25maWcgfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNvZ25pdG9Db25maXJtU2lnbnVwKFxuICB1c2VyOiBzdHJpbmcsXG4gIGNvZGU6IHN0cmluZyxcbiAgc2Vzc2lvbjogc3RyaW5nLFxuICBjb25maWc6IENvbmZpZyxcbik6IFByb21pc2U8QXV0aERhdGE+IHtcbiAgY29uc3QgY29nbml0byA9IG5ldyBDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudCh7XG4gICAgcmVnaW9uOiBjb25maWcuYXdzUmVnaW9uLFxuICB9KTtcblxuICBjb25zdCB2YWxpZGF0ZUVtYWlsQ29tbWFuZCA9IG5ldyBDb25maXJtU2lnblVwQ29tbWFuZCh7XG4gICAgQ2xpZW50SWQ6IGNvbmZpZy51c2VyUG9vbENsaWVudElkLFxuICAgIFVzZXJuYW1lOiB1c2VyLFxuICAgIENvbmZpcm1hdGlvbkNvZGU6IGNvZGUsXG4gICAgU2Vzc2lvbjogc2Vzc2lvbixcbiAgfSk7XG5cbiAgY29uc3QgeyBTZXNzaW9uIH0gPSBhd2FpdCBjb2duaXRvLnNlbmQodmFsaWRhdGVFbWFpbENvbW1hbmQpO1xuXG4gIGNvbnN0IGluaXRpYXRlQXV0aENvbW1hbmQgPSBuZXcgSW5pdGlhdGVBdXRoQ29tbWFuZCh7XG4gICAgQXV0aEZsb3c6IEF1dGhGbG93VHlwZS5VU0VSX0FVVEgsXG4gICAgQ2xpZW50SWQ6IGNvbmZpZy51c2VyUG9vbENsaWVudElkLFxuICAgIFNlc3Npb24sXG4gICAgQXV0aFBhcmFtZXRlcnM6IHtcbiAgICAgIFVTRVJOQU1FOiB1c2VyLFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGluaXRBdXRoUmVzcG9uc2UgPSBhd2FpdCBjb2duaXRvLnNlbmQoaW5pdGlhdGVBdXRoQ29tbWFuZCk7XG4gIHJldHVybiBnZXRBdXRoRGF0YUZyb21BdXRoSW5pdFJlc3BvbnNlKGluaXRBdXRoUmVzcG9uc2UpO1xufVxuIl19